name: Release Eum Server

on: 
    push:
        tags:
            - 'v*'

jobs:
    test_eum_server:
        uses: ./.github/workflows/eumserver_test.yml
        
    #test_release:
     #   name: "test release"
      #  runs-on: ubuntu-latest
       # needs: test_eum_server
        #steps:
         #   - name: Checkout code
          #    uses: actions/checkout@v3
           # - name: Create release
            #  run: gh release create ${{ github.ref }} --generate-notes
             # env:
              #  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
    
              
    build_assets:
        name: "Build assets"
        runs-on: ubuntu-latest
        environment: release
        needs: [test_eum_server]
        
        steps:
            - uses: actions/checkout@v3
            - name: Grant execute permission for gradlew
              run: chmod +x gradlew
            - name: run bootJar
              run: ./gradlew assemble build/bootJar
            
    publish_docker_images:
        name: "Publish docker image"
        runs-on: ubuntu-latest
        environment: release
        needs: [test_eum_server]
        
        steps:
            - uses: actions/checkout@v3
              name: Check out code
              
            - uses: mr-smithers-excellent/docker-build-push@v5
              name: Build & push Docker image
              with:
                image: danipaniii/testing
                tags: v1, latest
                registry: docker.io
                username: ${{ secrets.DOCKER_USERNAME }}
                password: ${{ secrets.DOCKER_PASSWORD }}
              
              
              
              
              
              
              

              
            
    